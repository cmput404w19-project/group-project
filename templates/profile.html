{% extends 'base.html' %}

{% block title %}Profile{% endblock %}

{% block content %}
<div id = "profile1" class="container" style="margin-left:10%; margin-top:3%">
	<script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
	<script type="text/javascript">

		function getAuthorData(url, userObject){
		  $.ajax({
		    type: 'GET',
		    url: url,
		    success: function(profileContent){
					console.log(profileContent);
        var Displayname = document.createElement("p");
				Displayname.innerHTML = "Displayname : "+ profileContent.profile.displayName;
				var profile1 = document.getElementById("profile1");
				profile1.appendChild(Displayname);

				var ProfileId = document.createElement("p");
				ProfileId.innerHTML = "Profile ID : "+ profileContent.profile.author_id;
				var profile1 = document.getElementById("profile1");
				profile1.appendChild(ProfileId);

				var Bio = document.createElement("p");
				Bio.innerHTML = "Bio : "+ profileContent.profile.bio;
				var profile1 = document.getElementById("profile1");
				profile1.appendChild(Bio);

				var Host = document.createElement("p");
				Host.innerHTML = "Host : "+ profileContent.profile.host;
				var profile1 = document.getElementById("profile1");
				profile1.appendChild(Host);

				var GitHub = document.createElement("p");
				GitHub.innerHTML = "GitHub : "+ profileContent.profile.github;
				var profile1 = document.getElementById("profile1");
				profile1.appendChild(GitHub);

				var Url = document.createElement("p");
				Url.innerHTML = "Url : "+ profileContent.profile.url;
				var profile1 = document.getElementById("profile1");
				profile1.appendChild(Url);

				if ("{{UserProfile.author_id}}"==profileContent.profile.author_id){
					//alert("yes!!");
					var EditButtonDiv = document.createElement("div");
					var EditButton = document.createElement("button");
					EditButton.innerHTML = "Edit Profile";
					var profile1 = document.getElementById("profile1");
					EditButtonDiv.appendChild(EditButton);
          profile1.appendChild(EditButtonDiv);
				}
		    }
		   });
		 }
		// function getProfile(url){
		// 	//let url = "/author"+author_id;
		// 	fetch(url,{
		// 		method:"GET",
    //   	credentials:"same-origin",
    //   	body:JSON.stringify(data),
    // 		headers:{
    //   		"Content-Type":"application/json",
    //     	'X-CSRFToken': Cookies.get('csrftoken')
    //   	},
		//
		// 	})
		// };

		//getProfile("/author/<str:author_id>/");

		getAuthorData("/author/{{UserProfile.author_id}}/")
		</script>
<!--
	<p class="login-title" style="font-size: 2.7em">Profile</p>
	<p class="profile" style="font-size: 1.3em; font-family:Muli"> Displayname : {{ userprofile.displayName }} </p>
	<p class="profile" style="font-size: 1.3em; font-family:Muli"> Profile ID :  {{ userprofile.author_id}}</p>
	<p class="profile" style="font-size: 1.3em; font-family:Muli"> Bio :  {{ userprofile.bio }}</p>
	<p class="profile" style="font-size: 1.3em; font-family:Muli"> Host :  {{ userprofile.host }}</p>
	<p class="profile" style="font-size: 1.3em; font-family:Muli"> GitHub :  {{ userprofile.github }}</p>
	<p class="profile" style="font-size: 1.3em; font-family:Muli"> Url :  {{ userprofile.url }}</p>
	<br>

	{%if thisUser.author_id == userprofile.author_id%}
		<a class="btn btn-default" href="/accounts/profile/edit">Edit Profile</a>

	{%elif not thisUser.author_id%}
    <a class="btn btn-default" href="/accounts/profile/edit">Edit Profile</a>

  {%elif is_following%}
    <form action="{% url 'unfollowrequest' pk=is_following.pk %}" data-method="DELETE" method="POST">
      {%  csrf_token %}
      <input id="DeleteButton" type="submit" class="btn btn-default" value="UnFollow">
    </form>
-->
	{%else%}
		<input id="FollowButton" type="button" class="btn btn-default" value="Follow">
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
    <script type="text/javascript"}>
      document.getElementById("FollowButton").onclick = updateRelation;

      data = {
                "query": "friendrequest",
                "author": {
                  "id": "{{ thisUser.author_id }}",
                  "host": "",
                  "displayName": "{{ thisUser.displayName }}",
                  "url": ""
                },
                "friend": {
                  "id": "{{ userprofile.author_id }}",
                  "host": "",
                  "displayName": "{{ userprofile.displayName }}",
                  "url": ""
                }
              }

      function updateRelation(){
        fetch('/friendrequest',
          {
            method: "post",
            headers: {
              "Content-Type": "application/json",
              'X-CSRFToken': Cookies.get('csrftoken')
            },
            body: JSON.stringify(data)
          });

        if (document.getElementById("FollowButton").value == "Follow"){
          document.getElementById("FollowButton").value="Following";
          document.getElementById("FollowButton").disable=true;
        }
        else if(document.getElementById("FollowButton").value == "Following"){
          document.getElementById("FollowButton").disable=true;
        }
      }
		</script>

</div>

{%endif%}
{% endblock %}
